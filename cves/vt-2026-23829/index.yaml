id: vt-2026-23829

info:
  name: "mailpit - Mailpit has an SMTP Header Injection via Regex Bypass"
  author: omarkurt
  description: |
    Mailpit is an email testing tool and API for developers. Prior to version 1.28.3, Mailpit's SMTP server is vulnerable to Header Injection due to an insufficient Regular Expression used to validate `RCPT TO` and `MAIL FROM` addresses. An attacker can inject arbitrary SMTP headers (or corrupt existing ones) by including carriage return characters (`\r`) in the email address. This header injection occurs because the regex intended to filter control characters fails to exclude `\r` and `\n` when used inside a character class. Version 1.28.3 fixes this issue.
  targets:
    - mailpit
    - web
    - SMTP
  type: CVE
  cve: CVE-2026-23829
  cwe: CWE-150
  cvss:
    score: 5.3
    severity: medium
  affected_versions:
    - "<= 1.28.2"
  tags:
    - go
    - medium
    - cve-2026
    - mailpit
    - header-injection
    - smtp
    - network
  references:
    - https://github.com/axllent/mailpit/commit/36cc06c125954dec6673219dafa084e13cc14534
    - https://github.com/axllent/mailpit/releases/tag/v1.28.3
    - https://github.com/axllent/mailpit/security/advisories/GHSA-54wq-72mp-cq7c
    - https://nvd.nist.gov/vuln/detail/CVE-2026-23829
    - https://github.com/advisories/GHSA-54wq-72mp-cq7c
    - https://vulnerabletarget.com/VT-2026-23829

vulnerabilities:
  endpoint: SMTP
  method: MAIL FROM / RCPT TO
  request: |
    EHLO example.com
    MAIL FROM:<attacker@example.com>
    RCPT TO:<victim\rX-Injected:true@example.com>
    DATA
    ...
  response: |
    250 Ok
    (Header injected in received email)

technical: |
  SMTP Header Injection via insufficient regex in address validation.
  File: internal/smtp/session.go

  The regex pattern used to validate MAIL FROM and RCPT TO addresses:
    var (
      addressRegex = regexp.MustCompile(`[^\x00-\x1f]+`)  // Flawed regex
    )

  The regex fails to properly exclude carriage return (\r, 0x0D) and
  line feed (\n, 0x0A) characters when used inside a negated character class.
  This allows an attacker to inject arbitrary SMTP headers by including
  bare CR characters in the email address.

  Payload: MAIL FROM:<attacker\rX-Pwned:injected>
  The \r (0x0D) breaks out of the address and injects a new header line.

impact: |
  Attackers can inject arbitrary SMTP headers into emails processed by Mailpit.
  This could lead to:
  - Email spoofing and phishing attacks
  - Bypassing spam filters
  - Corrupting email metadata
  - Potential email routing manipulation

remedy: |
  Update Mailpit to version 1.28.3 or later.
  The fix properly validates email addresses using RFC-compliant parsing
  instead of a flawed regex pattern.

poc:
  nuclei:
    - "vt-2026-23829-inject.yaml"
    - "vt-2026-23829-verify.yaml"
    - "vt-2026-23829-workflow.yaml"


providers:
  docker-compose:
    path: "docker-compose.yaml"
    ports:
      - 1025
      - 8025

post-install:
  - "Access Mailpit UI at http://localhost:8025"
  - "SMTP Service available at localhost:1025"
  - "No authentication required"
  - "Use vt-2026-23829-inject.yaml to send a test email with header injection payload"
  - "Use vt-2026-23829-verify.yaml to check for the injected header in the received email"
  - "or run vt-2026-23829-workflow.yaml to execute both steps in sequence"
